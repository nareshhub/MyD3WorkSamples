<!DOCTYPE html>
<meta charset="utf-8">
<style>

text {
  font: 11px sans-serif;
}

body {
margin-top: 100 px;
text-align: center;
}

g.legend {
            width: 200px;
            height: 200px;
        }

</style>
<body>
<script src="//d3js.org/d3.v3.min.js"></script>
<script>

/* function updateWindow(){
x = w.innerWidth || e.clientWidth || g.clientWidth;
y = w.innerHeight|| e.clientHeight|| g.clientHeight;

svg.attr("width", x).attr("height", y);
}
window.onresize = updateWindow; */

/* var lineSize = d3.scale.linear().domain([0,10]).range([2, 10]);

var svg1 = d3.select("svg");

svg1.append("g")
  .attr("class", "legendSizeLine")
  .attr("transform", "translate(0, 20)");

var legendSizeLine = d3.legend.size()
      .scale(lineSize)
      .shape("line")
      .orient("horizontal")
      //otherwise labels would have displayed:
      // 0, 2.5, 5, 10
      .labels(["tiny", "small", "medium", "large", "grand"])
      .shapeWidth(40)
      .labelAlign("start")
      .shapePadding(10);

svg1.select(".legendSizeLine")
  .call(legendSizeLine); */
         
       
var data =   {
		   "name": "",
		   "children": [
		    {
		     "name": "Clothing",
		     "children": [
		      {"name": "Shirts", "size": 8900, "perc":89},
		      {"name": "Jeans", "size": 8200, "perc":82},
		      {"name": "Suits&Blazers", "size": 7100, "perc":71},
		      {"name": "Jackets", "size": 6600, "perc":66},
		      {"name": "Under Garments", "size": 6400, "perc":64},
		      {"name": "Tops", "size": 4500, "perc":45},
		      {"name": "Active Wear", "size": 2100, "perc":21}
		     ]
		    },
		        {
		     "name": "Shoes",
		     "children": [
		      {"name": "Boots", "size": 6400, "perc":64},
		      {"name": "Sandals", "size": 4500, "perc":45},
		      {"name": "Heels", "size": 4500, "perc":45},
		      {"name": "Flats", "size": 3300, "perc":33},
		      {"name": "Flip Flops", "size": 2200, "perc":22},
		      {"name": "Wedges", "size": 1500, "perc":15}
		     ]
		    },
		     {
		     "name": "Accessories",
		     "children": [
		      {"name": "Watches", "size": 7100, "perc":71},
		      {"name": "Sunglasses", "size": 6300, "perc":63},
		      {"name": "Socks", "size": 4400, "perc":44},
		      {"name": "Belts", "size": 3700, "perc":37},
		      {"name": "Hats", "size": 3600, "perc":36},
		      {"name": "Gloves", "size": 1800, "perc":18}
		     ]
		    },
		    {
		     "name": "Jewelry",
		     "children": [
		      {"name": "Rings", "size": 7600, "perc":76},
		      {"name": "Earrings", "size": 2400, "perc":24},
		      {"name": "Necklace", "size": 1800, "perc":18},
		      {"name": "Bracelet", "size": 1600, "perc":16}
		     ]
		    },
		        {
		     "name": "Beauty",
		     "children": [
		      {"name": "Makeup", "size": 8400, "perc":84},
		      {"name": "Fragrance", "size": 4300, "perc":43},
		      {"name": "Skin Care", "size": 3300, "perc":33},
		      {"name": "Bath", "size": 1700, "perc":17},
		      {"name": "HairCare", "size": 1200, "perc":12}
		     ]
		    },
		          {
		     "name": "Handbags",
		     "children": [
		      {"name": "Wallets", "size": 6500, "perc":65},
		      {"name": "Purse", "size": 4900, "perc":49},
		      {"name": "Luggage Bags", "size": 2600, "perc":26},
		      {"name": "Totes", "size": 1500, "perc":15},
		      {"name": "Backpacks", "size": 1200, "perc":12}
		     ]
		    }
		   ]
		  }
	

d3.select(window).on('resize', resize); 

function resize() {
    // update width
    width = parseInt(d3.select('#chart').style('width'), 10);
    width = width - margin.left - margin.right;

    // resize the chart
    x.range([0, width]);
    d3.select(chart.node().parentNode)
        .style('height', (y.rangeExtent()[1] + margin.top + margin.bottom) + 'px')
        .style('width', (width + margin.left + margin.right) + 'px');

    chart.selectAll('rect.background')
        .attr('width', width);

    chart.selectAll('rect.percent')
        .attr('width', function(d) { return x(d.percent); });

    // update median ticks
    var median = d3.median(chart.selectAll('.bar').data(), 
        function(d) { return d.percent; });

    chart.selectAll('line.median')
        .attr('x1', x(median))
        .attr('x2', x(median));


    // update axes
    chart.select('.x.axis.top').call(xAxis.orient('top'));
    chart.select('.x.axis.bottom').call(xAxis.orient('bottom'));

}

var diameter = 700,
    format = d3.format(",d"),
    color = d3.scale.category20();

var bubble = d3.layout.pack()
    .sort(null)
    .size([diameter, diameter])
    .padding(1.0);

var nodes = bubble.nodes(data);

var svg = d3.select("body").append("svg")
    .attr("width", diameter)
    .attr("height", diameter)
    .attr("class", "bubble");

d3.json("nordstrom_designers_cat.json", function(error, root) {
  if (error) throw error;

  var node = svg.selectAll(".node")
      .data(bubble.nodes(classes(root))
      .filter(function(d) { return !d.children; }))
    .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

  node.append("title")
      .text(function(d) { return d.className + ": " + d.perc+"%"; });

  node.append("circle")
      .attr("r", function(d) { return d.r; })
      .style("fill", function(d) { return color(d.packageName); });
      //.style("fill", function(d, i) { return color(i % 8); })
  node.append("text")
      .attr("dy", ".3em")
     .style("text-anchor", "middle")
     .text(function(d) { return d.className.substring(0, d.r / 3); });
});

// Returns a flattened hierarchy containing all leaf nodes under the root.
function classes(root) {
  var classes = [];

  function recurse(name, node) {
    if (node.children) node.children.forEach(function(child) { recurse(node.name, child); });
    else classes.push({packageName: name, className: node.name, value: node.size, perc: node.perc});
  }

  recurse(null, root);
  return {children: classes};
}

 var legend_data = nodes.filter(function(d,i){  
  	d.original_index = i;
  	return d.children;
	});

 var legend = svg.append("g")
.attr("class", "legend")
.selectAll("g")
//.attr("height", 10px)
//.attr("width", 10px)
.data(legend_data)
.enter()
.append("g")

    .attr("transform", function(d,i){
    	var height=200;
        return "translate(" + d.depth*10 + "," + i*25 + ")"; 
        //return "translate(5,5)";
      }) 


legend.append("circle")
.attr("r",8)
.style("fill", function(d){return color(d.name)});

legend.append("text")
.attr("x", function(d,i){ return d.depth*10 +10;})
.attr("dy", "0.50em")
.text(function(d){return d.name;})  

     

d3.select(self.frameElement).style("height", diameter + "px");

</script>
</body>